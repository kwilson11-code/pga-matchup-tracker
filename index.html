<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PGA Matchup Tracker - Live Tee Times & Scores</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f4f4f4; }
        h1 { text-align: center; color: #004d00; }
        #search { width: 100%; max-width: 500px; padding: 12px; margin: 20px auto; display: block; font-size: 16px; border: 1px solid #ccc; border-radius: 4px; }
        #status { text-align: center; font-size: 18px; margin: 20px; font-weight: bold; }
        .error { color: red; }
        .group { background: white; border: 1px solid #ddd; border-radius: 8px; padding: 15px; margin: 15px auto; max-width: 600px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .favorite { border-color: #ffcc00; background: #fffef0; }
        .star { cursor: pointer; font-size: 28px; float: right; color: #ffcc00; }
        .player { margin: 10px 0; font-size: 16px; }
        .winner { font-weight: bold; color: #006400; background: #e0ffe0; padding: 4px; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>PGA 3-Ball/2-Ball Matchup Tracker</h1>
    <input type="text" id="search" placeholder="Search player name or tee time (e.g., Scheffler, 11:45)...">
    <div id="status">Loading live PGA data for today's tournament...</div>
    <div id="favorites"></div>
    <div id="all-groups"></div>

    <script>
        const API_BASE = 'https://golf-leaderboard-data.p.rapidapi.com';
const API_KEY = '400bc5a764msh71553cc3da7c3e9p1e506ejsn6bff53036f07';
const YEAR = '2026';

let allGroups = [];
let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');

async function apiCall(endpoint) {
    const response = await fetch(API_BASE + endpoint, {
        headers: {
            'x-rapidapi-key': API_KEY,
            'x-rapidapi-host': 'golf-leaderboard-data.p.rapidapi.com'
        }
    });
    if (!response.ok) {
        throw new Error(`API error: ${response.status} - ${response.statusText} for ${endpoint}`);
    }
    return await response.json();
}

async function getCurrentTournamentId() {
    try {
        const data = await apiCall(`/fixtures/pga/${YEAR}`);
        const tournaments = data.fixtures || data.tournaments || data || [];
        const active = tournaments.find(t => t.active === true || 
                                            t.status?.toLowerCase().includes('progress') ||
                                            (new Date(t.start_date || t.date_start) <= new Date() && new Date(t.end_date || t.date_end) >= new Date()));
        if (!active) throw new Error('No active tournament in fixtures response.');
        document.getElementById('status').textContent = `Loaded: ${active.name || active.tournament_name || 'Current PGA Event'} (Round ${active.current_round || '?'})`;
        console.log('Active tournament data:', active); // Debug in console
        return active.tournament_id || active.id || active.tourn_id;
    } catch (err) {
        console.error('Fixtures fetch failed:', err);
        // Optional fallback: try a different path or hardcoded for testing
        // return 'YOUR_KNOWN_TOURNAMENT_ID_HERE'; // e.g., test with one from playground
        throw err;
    }
}

// ... (keep getLeaderboard, groupByTeeTime, getGroupWinner, renderGroups the same as before)

async function loadData() {
    const status = document.getElementById('status');
    status.className = '';
    status.textContent = 'Fetching live tournament fixtures & leaderboard...';
    try {
        const tid = await getCurrentTournamentId();
        console.log('Using tournament ID:', tid);
        const players = await apiCall(`/leaderboard/${tid}/${YEAR}`);
        const leaderboardData = players.leaderboard || players.players || players || [];
        console.log('Leaderboard players count:', leaderboardData.length);
        allGroups = groupByTeeTime(leaderboardData);

        renderGroups(allGroups.filter(g => favorites.includes(g.teeTime)), 'favorites');
        const query = document.getElementById('search').value.toLowerCase();
        const filtered = query 
            ? allGroups.filter(g => g.teeTime.toLowerCase().includes(query) || 
                                    g.players.some(p => p.player_name.toLowerCase().includes(query)))
            : allGroups;
        renderGroups(filtered, 'all-groups');
    } catch (err) {
        console.error('Load data error:', err);
        status.textContent = `Error: ${err.message}. Open F12 Console for details. PGA is live â€” try refreshing or check RapidAPI playground for correct endpoints/IDs.`;
        status.className = 'error';
    }
}
    </script>
</body>
</html>
